import os
import mysql.connector
from dotenv import load_dotenv

load_dotenv()

# Check socket
socket_path = '/cloudsql/wizling:us-central1:s-layden-mysql'
print(f"Socket exists: {os.path.exists(socket_path)}")

# Database connection
config = {
    'user': os.getenv('DB_USER'),
    'password': os.getenv('DB_PASSWORD'),
    'database': os.getenv('CMS_DB'),
    'unix_socket': socket_path,
    'auth_plugin': 'caching_sha2_password'
}

try:
    conn = mysql.connector.connect(**config)
    print("Successfully connected to database")
    cursor = conn.cursor()
    cursor.execute("SELECT DATABASE()")
    result = cursor.fetchone()
    print(f"Connected to database: {result[0]}")
    conn.close()
except Exception as e:
    print(f"Error connecting to database: {e}")